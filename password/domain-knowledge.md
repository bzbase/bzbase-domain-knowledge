# 密码

## 核心概念
密码（Password）是用户用来验证身份的一串字符串。是用户访问系统保护个人数据的重要手段。密码的管理涉及到密码策略规则、密码存储以及验证。

## 密码策略
过于简单的密码会很容易被攻击者破解(比如使用暴力破解等方式)，我们会设定一组规则要求即密码策略来确保用户创建的密码具有足够的复杂度和安全性。

常见的密码策略通常使用以下的规则来提高密码的复杂度：
1. 限制密码字符的长度，比如密码至少 8 位。
2. 限制密码的字符种类，比如密码必须包含大小写字母、数字、特殊字符等。
3. 限制密码不得包含随机性低的字符序列，比如不能包含递增递减的连续字符(如12345、abacd)、重复的相同字符(如bbbbb、33333)、键盘模式字符(如qwerty、zxcvb)。
4. 限制密码不能使用常用的弱密码，比如建立常用弱密码字典(如123456、password)，限制密码不能在该字典内。
5. 建立密码强度检测机制(比如弱、中、强、极强)，限定密码强度必须达到指定等级。

应用开发中有一些常见的密码策略，这里整理一下可供参考：
1. 8-20位，至少包含英文字母，数字，特殊符号中的2种。
2. 8-20位，至少包含大写字母，小写字母，数字，特殊符号中的3种。
3. 8-20位，至少包含一个英文字母，一个数字。
4. 8-20位，至少包含一个大写字母，一个小写字母，一个数字。
5. 8-20位，至少包含一个英文字母，一个数字，一个特殊符号。
6. 8-20位，至少包含一个大写字母，一个小写字母，一个数字，一个特殊符号。

## 密码存储
密码是用户最重要的安全凭证，其存储需要满足两个要求，一是防止可直接查看获取到明文密码，二是即使被攻击者窃取泄露后也无法破解得出原始明文密码。
为此通常引入一种不可逆的算法对明文密码进行转换后存储，在密码学中包含一种算法称为**哈希算法（Hash）**，又称哈希函数、散列算法、散列函数。 
此种算法具备以下几个特点：
1. 不可逆性，即无法通过转换后的哈希值反推原始明文。
2. 输出长度固定，无论输入数据的大小如何，哈希算法生成的输出哈希值都是固定长度的。
3. 确定性，即相同的输入数据，哈希算法生成的哈希值总是相同的。
4. 唯一性，理论上不同的输入数据，生成的输出哈希值不同，即产生哈希碰撞的概率极低。 
 
由于这些特性，哈希算法广泛应用于验证数据完整性、密码存储等场景。需要注意的是不要混淆哈希算法和加密算法，加密算法是可逆的(明文可加密成密文，密文可解密成明文)用于保护敏感数据的算法。

### 常用于密码存储的哈希算法
- **Argon2**: 密码哈希竞赛冠军，抗 GPU 和 ASIC 攻击。
- **Bcrypt**: 基于 Blowfish 密码算法，内置加盐机制。
- **PBKDF2**: 使用伪随机函数，支持重复迭代的密钥派生函数。
- **Scrypt**: 设计比 PBKDF2 或 Bcrypt 等哈希函数更能抵御硬件暴力破解攻击的算法。
- **MD5**: 输出128位的散列值，已被证实无法防止碰撞攻击，切勿使用。
- **SHA**: FIPS所认证的安全散列算法，SHA-1存在碰撞攻击，逐步淘汰中，推荐SHA-2或者SHA-3。

对于哈希算法的选择，根据OWASP(开放式Web应用程序安全组织)的[建议](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)：
**优先使用 Argon2，其次是 Scrypt，对于采用 Bcrypt 的系统，建议采用工作因子为 10 或更高，并设置密码长度限制为 72 字节。对于使用 PBKDF2 的系统，工作因子设置为 600,000 或更高，并采用 HMAC-SHA-256 作为内部哈希函数。**

### 盐值（Salt）的使用
哈希算法针对相同的输入数据，生成的哈希值总是相同的，这意味着在密码存储时，相同密码将会产生相同的哈希值，如果密码数据泄露了则可以通过哈希值字典比对反推明文密码（俗称彩虹表攻击），为了避免这种情况，我们希望无论输入是否相同，哈希输出都是唯一不同的，为此我们可以在对明文进行哈希处理时，额外增加一段随机数据来达到此目的，这段额外的随机数据我们称为盐值，这个过程称为加盐。总之在存储用户密码时，应当为每个用户生成不同的随机盐值，然后对密码和盐值进行哈希处理，最后将盐值和哈希值一起存储到数据库中供后续验证使用。

### 胡椒（Pepper)的使用
当密码数据泄露后虽然增加盐值可以增加攻击者破解密码的难度和时间成本，但这并不是万无一失的，在此之上，我们还可以增加Pepper即胡椒，胡椒就是一个保密的盐值，在功能上和盐值类似，都是在使用哈希函数处理时加入到输入中的随机内容，但是不同之处在于盐值通常和哈希值一起存储在数据库中，而胡椒是单独存储的，以防止在数据库泄露时被攻击者一并获取。胡椒就相当于加密算法中的密钥，是保密不公开的。
